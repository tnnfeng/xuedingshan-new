<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>雪顶山矿泉 - 所见即所得管理后台</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* 管理后台专用样式 */
        .admin-header {
            background: linear-gradient(135deg, #0077b6, #00b4d8);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        .admin-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .admin-logo {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .page-tabs {
            display: flex;
            gap: 1rem;
        }
        
        .page-tab {
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.2);
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .page-tab.active {
            background: rgba(255,255,255,0.4);
        }
        
        .admin-controls {
            display: flex;
            gap: 1rem;
        }
        
        .admin-btn {
            padding: 0.5rem 1rem;
            background: white;
            color: #0077b6;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .admin-main {
            margin-top: 80px;
            height: calc(100vh - 80px);
        }
        
        .page-frame {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .edit-mode {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: #0077b6;
            color: white;
            padding: 1rem;
            border-radius: 10px;
            z-index: 1001;
            min-width: 250px;
            display: none; /* 默认隐藏 */
        }
        
        .edit-toggle {
            background: white;
            color: #0077b6;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 0.5rem;
            width: 100%;
            font-weight: bold;
        }
        
        .edit-toolbar {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .edit-tool {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 0.3rem 0.6rem;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .edit-tool:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .editable {
            outline: 2px dashed #0077b6 !important;
            cursor: text;
            min-height: 20px;
            position: relative;
        }
        
        .editable:hover {
            background: rgba(0, 119, 182, 0.1);
        }
        
        .editable::before {
            content: '✎';
            position: absolute;
            top: -10px;
            left: -10px;
            background: #0077b6;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .editable:hover::before {
            opacity: 1;
        }
        
        .editable-container {
            position: relative;
            outline: 2px dashed #00b4d8 !important;
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        
        .editable-container:hover {
            background: rgba(0, 180, 216, 0.05);
        }
        
        .container-controls {
            position: absolute;
            top: -15px;
            right: -15px;
            background: #00b4d8;
            border-radius: 15px;
            padding: 5px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .editable-container:hover .container-controls {
            opacity: 1;
        }
        
        .container-btn {
            background: white;
            color: #00b4d8;
            border: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .addable {
            outline: 2px dashed #28a745 !important;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .addable:hover {
            background: rgba(40, 167, 69, 0.1);
        }
        
        .addable::before {
            content: '+ 添加内容';
            color: #28a745;
            font-weight: bold;
        }
        

        
        .editable-image {
            outline: 2px dashed #00b4d8 !important;
            cursor: pointer;
            position: relative;
        }
        
        .editable-image::after {
            content: '点击更换图片';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 119, 182, 0.8);
            color: white;
            padding: 0.5rem;
            border-radius: 5px;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .editable-image:hover::after {
            opacity: 1;
        }
        
        .image-upload-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            z-index: 2000;
        }
        
        .image-upload-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 10px;
            width: 400px;
        }
    </style>
</head>
<body>
    <!-- 管理后台头部 -->
    <header class="admin-header">
        <nav class="admin-nav">
            <div class="admin-logo">
                <i class="fas fa-cogs"></i> 雪顶山矿泉管理后台
            </div>
            
            <div class="page-tabs">
                <div class="page-tab active" data-page="index.html">首页</div>
                <div class="page-tab" data-page="about.html">关于我们</div>
                <div class="page-tab" data-page="contact.html">联系我们</div>
                <div class="page-tab" data-page="join.html">招聘信息</div>
                <div class="page-tab" data-page="health.html">健康饮水</div>
            </div>
            
            <div class="admin-controls">
                <button class="admin-btn" onclick="saveAllContent()">
                    <i class="fas fa-save"></i> 保存所有修改
                </button>
                <button class="admin-btn" onclick="toggleEditMode()">
                    <i class="fas fa-edit"></i> 编辑模式
                </button>
                <button class="admin-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> 退出
                </button>
            </div>
        </nav>
    </header>

    <!-- 主内容区域 -->
    <main class="admin-main">
        <iframe id="pageFrame" class="page-frame" src="index.html"></iframe>
    </main>

    <!-- 编辑模式控制面板 -->
    <div class="edit-mode" id="editModePanel">
        <button class="edit-toggle" onclick="toggleEditMode()">
            <i class="fas fa-times"></i> 关闭编辑
        </button>
        
        <div class="edit-toolbar">
            <button class="edit-tool" onclick="addTextElement()" title="添加文本">
                <i class="fas fa-font"></i>
            </button>
            <button class="edit-tool" onclick="addImageElement()" title="添加图片">
                <i class="fas fa-image"></i>
            </button>
            <button class="edit-tool" onclick="addSectionElement()" title="添加区块">
                <i class="fas fa-square"></i>
            </button>
            <button class="edit-tool" onclick="deleteSelected()" title="删除选中">
                <i class="fas fa-trash"></i>
            </button>
        </div>
        
        <div style="color: white; font-size: 0.9rem;">
            <p><strong>编辑说明：</strong></p>
            <p>• 点击文字直接编辑</p>
            <p>• 点击图片更换图片</p>
            <p>• 点击+号添加内容</p>
            <p>• 点击×号删除内容</p>
            <p>• 修改后记得保存</p>
        </div>
    </div>

    <!-- 图片上传模态框 -->
    <div class="image-upload-modal" id="imageUploadModal">
        <div class="image-upload-content">
            <h3>更换图片</h3>
            <input type="file" id="imageFileInput" accept="image/*">
            <div style="margin-top: 1rem; display: flex; gap: 1rem;">
                <button class="admin-btn" onclick="uploadImage()">上传</button>
                <button class="admin-btn" onclick="closeImageModal()">取消</button>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let isEditMode = false;
        let currentEditingImage = null;
        let pageContent = {};
        let selectedElement = null;

        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 绑定标签页切换事件
            document.querySelectorAll('.page-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // 移除所有激活状态
                    document.querySelectorAll('.page-tab').forEach(t => t.classList.remove('active'));
                    // 设置当前激活状态
                    this.classList.add('active');
                    // 加载对应页面
                    const page = this.getAttribute('data-page');
                    document.getElementById('pageFrame').src = page;
                });
            });

            // 加载保存的内容
            loadSavedContent();
        });

        // 切换编辑模式
        function toggleEditMode() {
            isEditMode = !isEditMode;
            const frame = document.getElementById('pageFrame');
            const editPanel = document.getElementById('editModePanel');
            
            if (isEditMode) {
                // 启用编辑模式
                editPanel.style.display = 'block';
                // 向iframe注入编辑脚本
                injectEditScript(frame);
            } else {
                // 关闭编辑模式
                editPanel.style.display = 'none';
                // 移除编辑功能
                removeEditScript(frame);
            }
        }

        // 向iframe注入编辑脚本
        function injectEditScript(frame) {
            const iframeDoc = frame.contentDocument || frame.contentWindow.document;
            
            // 添加编辑样式
            const style = iframeDoc.createElement('style');
            style.textContent = `
                .editable {
                    outline: 2px dashed #0077b6 !important;
                    cursor: text;
                    min-height: 20px;
                }
                .editable:hover {
                    background: rgba(0, 119, 182, 0.1);
                }
                .editable-image {
                    outline: 2px dashed #00b4d8 !important;
                    cursor: pointer;
                    position: relative;
                }
                .editable-image::after {
                    content: '点击更换图片';
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 119, 182, 0.8);
                    color: white;
                    padding: 0.5rem;
                    border-radius: 5px;
                    font-size: 0.8rem;
                    opacity: 0;
                    transition: opacity 0.3s;
                }
                .editable-image:hover::after {
                    opacity: 1;
                }
            `;
            iframeDoc.head.appendChild(style);

            // 标记可编辑元素
            markEditableElements(iframeDoc);

            // 添加编辑事件监听
            addEditEventListeners(iframeDoc);
        }

        // 标记可编辑元素
        function markEditableElements(doc) {
            // 标记所有文本元素
            const textElements = doc.querySelectorAll('h1, h2, h3, h4, h5, h6, p, span, li, td, a, strong, em');
            textElements.forEach(el => {
                if (el.textContent.trim() && !el.closest('.admin-header')) {
                    el.classList.add('editable');
                    el.setAttribute('contenteditable', 'true');
                    
                    // 包装可编辑容器
                    if (!el.parentElement.classList.contains('editable-container')) {
                        const container = doc.createElement('div');
                        container.className = 'editable-container';
                        el.parentNode.insertBefore(container, el);
                        container.appendChild(el);
                        
                        // 添加删除按钮
                        const deleteBtn = doc.createElement('button');
                        deleteBtn.className = 'container-btn';
                        deleteBtn.innerHTML = '×';
                        deleteBtn.onclick = function(e) {
                            e.stopPropagation();
                            if (confirm('确定要删除这个内容吗？')) {
                                container.remove();
                            }
                        };
                        
                        const controls = doc.createElement('div');
                        controls.className = 'container-controls';
                        controls.appendChild(deleteBtn);
                        container.appendChild(controls);
                    }
                }
            });

            // 标记所有图片
            const images = doc.querySelectorAll('img');
            images.forEach(img => {
                if (!img.closest('.admin-header')) {
                    img.classList.add('editable-image');
                    
                    // 包装图片容器
                    if (!img.parentElement.classList.contains('editable-container')) {
                        const container = doc.createElement('div');
                        container.className = 'editable-container';
                        img.parentNode.insertBefore(container, img);
                        container.appendChild(img);
                        
                        // 添加删除按钮
                        const deleteBtn = doc.createElement('button');
                        deleteBtn.className = 'container-btn';
                        deleteBtn.innerHTML = '×';
                        deleteBtn.onclick = function(e) {
                            e.stopPropagation();
                            if (confirm('确定要删除这张图片吗？')) {
                                container.remove();
                            }
                        };
                        
                        const controls = doc.createElement('div');
                        controls.className = 'container-controls';
                        controls.appendChild(deleteBtn);
                        container.appendChild(controls);
                    }
                }
            });
            
            // 添加可添加区域
            addAddableAreas(doc);
        }

        // 添加编辑事件监听
        function addEditEventListeners(doc) {
            // 文本编辑事件
            doc.addEventListener('input', function(e) {
                if (e.target.classList.contains('editable')) {
                    // 文本内容已修改
                    console.log('内容已修改:', e.target.textContent);
                }
            });

            // 图片点击事件
            doc.addEventListener('click', function(e) {
                if (e.target.classList.contains('editable-image')) {
                    e.preventDefault();
                    currentEditingImage = e.target;
                    openImageModal();
                }
            });
            
            // 添加区域点击事件
            doc.addEventListener('click', function(e) {
                if (e.target.classList.contains('addable')) {
                    e.preventDefault();
                    showAddOptions(e.target);
                }
            });
        }
        
        // 添加可添加区域
        function addAddableAreas(doc) {
            // 在主要内容区域之后添加可添加区域
            const mainContainers = doc.querySelectorAll('.container, .content-section, .section');
            mainContainers.forEach(container => {
                if (!container.querySelector('.addable')) {
                    const addableArea = doc.createElement('div');
                    addableArea.className = 'addable';
                    container.appendChild(addableArea);
                }
            });
        }
        
        // 显示添加选项
        function showAddOptions(target) {
            const option = prompt('请选择要添加的内容类型：\n1. 文本段落\n2. 图片\n3. 标题\n4. 按钮\n请输入数字：');
            
            switch(option) {
                case '1':
                    addTextElement(target);
                    break;
                case '2':
                    addImageElement(target);
                    break;
                case '3':
                    addTitleElement(target);
                    break;
                case '4':
                    addButtonElement(target);
                    break;
                default:
                    alert('请选择有效的选项');
            }
        }



        // 打开图片上传模态框
        function openImageModal() {
            document.getElementById('imageUploadModal').style.display = 'block';
        }

        // 关闭图片上传模态框
        function closeImageModal() {
            document.getElementById('imageUploadModal').style.display = 'none';
            currentEditingImage = null;
        }

        // 上传图片
        function uploadImage() {
            const fileInput = document.getElementById('imageFileInput');
            const file = fileInput.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    if (currentEditingImage) {
                        currentEditingImage.src = e.target.result;
                        // 保存图片修改
                        saveImageChange(currentEditingImage.src);
                    }
                    closeImageModal();
                    fileInput.value = '';
                };
                reader.readAsDataURL(file);
            }
        }

        // 添加文本元素
        function addTextElement(target = null) {
            const frame = document.getElementById('pageFrame');
            const iframeDoc = frame.contentDocument || frame.contentWindow.document;
            
            const container = iframeDoc.createElement('div');
            container.className = 'editable-container';
            
            const textElement = iframeDoc.createElement('p');
            textElement.className = 'editable';
            textElement.setAttribute('contenteditable', 'true');
            textElement.textContent = '请输入文本内容...';
            
            // 添加删除按钮
            const deleteBtn = iframeDoc.createElement('button');
            deleteBtn.className = 'container-btn';
            deleteBtn.innerHTML = '×';
            deleteBtn.onclick = function(e) {
                e.stopPropagation();
                if (confirm('确定要删除这个内容吗？')) {
                    container.remove();
                }
            };
            
            const controls = iframeDoc.createElement('div');
            controls.className = 'container-controls';
            controls.appendChild(deleteBtn);
            
            container.appendChild(textElement);
            container.appendChild(controls);
            
            // 插入到目标位置或默认位置
            if (target) {
                target.parentNode.insertBefore(container, target);
            } else {
                const mainContent = iframeDoc.querySelector('main') || iframeDoc.body;
                mainContent.appendChild(container);
            }
        }

        // 添加图片元素
        function addImageElement(target = null) {
            const frame = document.getElementById('pageFrame');
            const iframeDoc = frame.contentDocument || frame.contentWindow.document;
            
            const container = iframeDoc.createElement('div');
            container.className = 'editable-container';
            
            const imgElement = iframeDoc.createElement('img');
            imgElement.className = 'editable-image';
            imgElement.src = './images/logo.jpg'; // 默认图片
            imgElement.alt = '新图片';
            imgElement.style.maxWidth = '100%';
            imgElement.style.height = 'auto';
            
            // 添加删除按钮
            const deleteBtn = iframeDoc.createElement('button');
            deleteBtn.className = 'container-btn';
            deleteBtn.innerHTML = '×';
            deleteBtn.onclick = function(e) {
                e.stopPropagation();
                if (confirm('确定要删除这张图片吗？')) {
                    container.remove();
                }
            };
            
            const controls = iframeDoc.createElement('div');
            controls.className = 'container-controls';
            controls.appendChild(deleteBtn);
            
            container.appendChild(imgElement);
            container.appendChild(controls);
            
            // 插入到目标位置或默认位置
            if (target) {
                target.parentNode.insertBefore(container, target);
            } else {
                const mainContent = iframeDoc.querySelector('main') || iframeDoc.body;
                mainContent.appendChild(container);
            }
        }

        // 添加标题元素
        function addTitleElement(target = null) {
            const frame = document.getElementById('pageFrame');
            const iframeDoc = frame.contentDocument || frame.contentWindow.document;
            
            const container = iframeDoc.createElement('div');
            container.className = 'editable-container';
            
            const titleElement = iframeDoc.createElement('h3');
            titleElement.className = 'editable';
            titleElement.setAttribute('contenteditable', 'true');
            titleElement.textContent = '请输入标题...';
            
            // 添加删除按钮
            const deleteBtn = iframeDoc.createElement('button');
            deleteBtn.className = 'container-btn';
            deleteBtn.innerHTML = '×';
            deleteBtn.onclick = function(e) {
                e.stopPropagation();
                if (confirm('确定要删除这个标题吗？')) {
                    container.remove();
                }
            };
            
            const controls = iframeDoc.createElement('div');
            controls.className = 'container-controls';
            controls.appendChild(deleteBtn);
            
            container.appendChild(titleElement);
            container.appendChild(controls);
            
            // 插入到目标位置或默认位置
            if (target) {
                target.parentNode.insertBefore(container, target);
            } else {
                const mainContent = iframeDoc.querySelector('main') || iframeDoc.body;
                mainContent.appendChild(container);
            }
        }

        // 添加按钮元素
        function addButtonElement(target = null) {
            const frame = document.getElementById('pageFrame');
            const iframeDoc = frame.contentDocument || frame.contentWindow.document;
            
            const container = iframeDoc.createElement('div');
            container.className = 'editable-container';
            
            const buttonElement = iframeDoc.createElement('a');
            buttonElement.className = 'editable cta-button primary';
            buttonElement.setAttribute('contenteditable', 'true');
            buttonElement.textContent = '点击这里';
            buttonElement.href = '#';
            buttonElement.style.display = 'inline-block';
            buttonElement.style.padding = '10px 20px';
            buttonElement.style.backgroundColor = '#0077b6';
            buttonElement.style.color = 'white';
            buttonElement.style.textDecoration = 'none';
            buttonElement.style.borderRadius = '5px';
            
            // 添加删除按钮
            const deleteBtn = iframeDoc.createElement('button');
            deleteBtn.className = 'container-btn';
            deleteBtn.innerHTML = '×';
            deleteBtn.onclick = function(e) {
                e.stopPropagation();
                if (confirm('确定要删除这个按钮吗？')) {
                    container.remove();
                }
            };
            
            const controls = iframeDoc.createElement('div');
            controls.className = 'container-controls';
            controls.appendChild(deleteBtn);
            
            container.appendChild(buttonElement);
            container.appendChild(controls);
            
            // 插入到目标位置或默认位置
            if (target) {
                target.parentNode.insertBefore(container, target);
            } else {
                const mainContent = iframeDoc.querySelector('main') || iframeDoc.body;
                mainContent.appendChild(container);
            }
        }

        // 删除选中元素
        function deleteSelected() {
            const frame = document.getElementById('pageFrame');
            const iframeDoc = frame.contentDocument || frame.contentWindow.document;
            
            const selected = iframeDoc.querySelector('.editable-container:hover');
            if (selected && confirm('确定要删除这个内容吗？')) {
                selected.remove();
            } else {
                alert('请先悬停要删除的内容');
            }
        }

        // 添加区块元素
        function addSectionElement() {
            const frame = document.getElementById('pageFrame');
            const iframeDoc = frame.contentDocument || frame.contentWindow.document;
            
            const section = iframeDoc.createElement('section');
            section.className = 'editable-container';
            section.style.padding = '40px 0';
            section.style.backgroundColor = '#f8f9fa';
            section.style.margin = '20px 0';
            
            const title = iframeDoc.createElement('h2');
            title.className = 'editable';
            title.setAttribute('contenteditable', 'true');
            title.textContent = '新区块标题';
            title.style.textAlign = 'center';
            title.style.marginBottom = '20px';
            
            const content = iframeDoc.createElement('p');
            content.className = 'editable';
            content.setAttribute('contenteditable', 'true');
            content.textContent = '请输入新区块的内容...';
            content.style.textAlign = 'center';
            
            // 添加删除按钮
            const deleteBtn = iframeDoc.createElement('button');
            deleteBtn.className = 'container-btn';
            deleteBtn.innerHTML = '×';
            deleteBtn.onclick = function(e) {
                e.stopPropagation();
                if (confirm('确定要删除这个区块吗？')) {
                    section.remove();
                }
            };
            
            const controls = iframeDoc.createElement('div');
            controls.className = 'container-controls';
            controls.appendChild(deleteBtn);
            
            section.appendChild(title);
            section.appendChild(content);
            section.appendChild(controls);
            
            const mainContent = iframeDoc.querySelector('main') || iframeDoc.body;
            mainContent.appendChild(section);
        }

        // 移除编辑脚本
        function removeEditScript(frame) {
            const iframeDoc = frame.contentDocument || frame.contentWindow.document;
            
            // 移除编辑样式
            const style = iframeDoc.querySelector('style');
            if (style) style.remove();
            
            // 移除可编辑属性
            const editables = iframeDoc.querySelectorAll('.editable, .editable-image');
            editables.forEach(el => {
                el.classList.remove('editable', 'editable-image');
                el.removeAttribute('contenteditable');
            });
            
            // 移除容器控件（删除按钮、拖拽手柄等）
            const containers = iframeDoc.querySelectorAll('.editable-container');
            containers.forEach(container => {
                const controls = container.querySelector('.container-controls');
                if (controls) {
                    controls.remove();
                }
                
                // 恢复原始元素到正常位置
                const content = container.querySelector('.editable, .editable-image, img, h1, h2, h3, h4, h5, h6, p, span, li, td, a, strong, em');
                if (content) {
                    container.parentNode.insertBefore(content, container);
                    container.remove();
                }
            });
            
            // 移除可添加区域
            const addables = iframeDoc.querySelectorAll('.addable');
            addables.forEach(addable => {
                addable.remove();
            });
        }

        // 保存所有修改
        async function saveAllContent() {
            const frame = document.getElementById('pageFrame');
            const iframeDoc = frame.contentDocument || frame.contentWindow.document;
            
            // 收集所有修改的内容
            const modifiedContent = collectModifiedContent(iframeDoc);
            
            try {
                // 保存到服务器
                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(modifiedContent)
                });
                
                if (response.ok) {
                    alert('所有修改已保存成功！');
                } else {
                    alert('保存失败，请重试');
                }
            } catch (error) {
                console.error('保存失败:', error);
                alert('保存失败，请检查网络连接');
            }
        }

        // 收集修改的内容
        function collectModifiedContent(doc) {
            const content = {};
            const currentPage = document.querySelector('.page-tab.active').getAttribute('data-page');
            
            // 根据当前页面收集内容
            switch(currentPage) {
                case 'index.html':
                    content.home = collectHomeContent(doc);
                    break;
                case 'about.html':
                    content.about = collectAboutContent(doc);
                    break;
                case 'contact.html':
                    content.contact = collectContactContent(doc);
                    break;
                case 'join.html':
                    content.join = collectJoinContent(doc);
                    break;
                case 'health.html':
                    content.health = collectHealthContent(doc);
                    break;
            }
            
            return content;
        }

        // 收集首页内容（示例）
        function collectHomeContent(doc) {
            return {
                heroTitle: doc.querySelector('.hero-title')?.textContent || '',
                heroSubtitle: doc.querySelector('.hero-subtitle')?.textContent || '',
                heroSlogan: doc.querySelector('.hero-slogan')?.textContent || '',
                aboutText: doc.querySelector('.about p')?.textContent || ''
            };
        }

        // 收集关于我们内容（示例）
        function collectAboutContent(doc) {
            return {
                companyIntro: doc.querySelector('.company-intro p')?.textContent || '',
                foundingYear: doc.querySelector('.founding-year')?.textContent || '',
                factoryArea: doc.querySelector('.factory-area')?.textContent || ''
            };
        }

        // 收集联系我们内容（示例）
        function collectContactContent(doc) {
            return {
                contactPageTitle: doc.querySelector('.page-title')?.textContent || '',
                contactPageSubtitle: doc.querySelector('.page-subtitle')?.textContent || ''
            };
        }

        // 收集招聘信息内容（示例）
        function collectJoinContent(doc) {
            return {
                joinPageTitle: doc.querySelector('.page-title')?.textContent || '',
                joinPageSubtitle: doc.querySelector('.page-subtitle')?.textContent || ''
            };
        }

        // 收集健康饮水内容（示例）
        function collectHealthContent(doc) {
            return {
                healthTitle: doc.querySelector('.page-title')?.textContent || '',
                healthSubtitle: doc.querySelector('.page-subtitle')?.textContent || ''
            };
        }

        // 保存图片修改
        function saveImageChange(imageSrc) {
            // 这里可以添加图片保存逻辑
            console.log('图片已修改:', imageSrc);
        }

        // 加载保存的内容
        async function loadSavedContent() {
            try {
                const response = await fetch('/api/config');
                const config = await response.json();
                pageContent = config;
            } catch (error) {
                console.error('加载配置失败:', error);
            }
        }

        // 退出登录
        function logout() {
            if (confirm('确定要退出管理后台吗？')) {
                window.location.href = 'index.html';
            }
        }

        // iframe加载完成事件
        document.getElementById('pageFrame').onload = function() {
            if (isEditMode) {
                // 重新注入编辑脚本
                injectEditScript(this);
            }
        };
    </script>
</body>
</html>